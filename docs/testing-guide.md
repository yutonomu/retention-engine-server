# テスト実行ガイド

このプロジェクトのテストコードの実行方法について説明します。

## 🧪 テストの種類

| 種類 | ファイル拡張子 | 配置場所 | 目的 |
|------|--------------|----------|------|
| **ユニットテスト** | `.spec.ts` | `src/` 配下 | クラスや関数単体の動作確認 |
| **E2Eテスト** | `.e2eSpec.ts` | `test/` 配下 | API全体（エンドツーエンド）の動作確認 |

---

## 🚀 テストの実行方法

### 1. 全てのユニットテストを実行
プロジェクト内の全ての `.spec.ts` ファイルを実行します。

```bash
npm run test
```

**Watchモード（開発中におすすめ）**
ファイルを変更するたびに自動でテストを再実行します。
```bash
npm run test:watch
```

### 2. 特定のテストファイルのみ実行
特定の機能だけを確認したい場合に便利です。

**例: UserServiceのテストのみ実行**
```bash
npm run test -- user.service.spec.ts
```

**例: User型のテストのみ実行**
```bash
npm run test -- user.types.spec.ts
```

### 3. E2Eテストを実行
APIエンドポイント全体の動作を確認します。

```bash
npm run test:e2e
```

**特定のE2Eテストのみ実行**
```bash
npm run test:e2e -- user-mbti.e2eSpec.ts
```

### 4. カバレッジを確認
どのくらいコードがテストされているか（網羅率）を確認します。

```bash
npm run test:cov
```
実行後、`coverage/` ディレクトリにレポートが生成されます。

---

## 🐛 デバッグ方法

テストが失敗する場合、詳細なログを出力してデバッグできます。

```bash
# 特定のテストをデバッグ実行
npm run test:debug -- user.service.spec.ts
```

---

## 📝 よくある質問

### Q. なぜ `.spec.ts` なのですか？
A. BDD（振る舞い駆動開発）の慣習で、「テスト」ではなく「仕様（Specification）」を記述するという意味が込められています。

### Q. E2Eテストが失敗します
A. E2Eテストは実際のデータベース構造に依存する場合があります。マイグレーションが最新か確認してください。
```bash
# データベースの状態を確認（Supabaseダッシュボード等で）
```
